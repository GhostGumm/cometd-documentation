<?xml version="1.0" encoding="UTF-8"?>
<section version="5.0"
         xmlns="http://docbook.org/ns/docbook"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:xl="http://www.w3.org/1999/xlink"
         xml:id="extensions_reload">
<info>
    <title>CometD 2 Reload Extension</title>
</info>
<para>>
The reload extension allows CometD to load or reload a page without having to re-handshake in the new (or reloaded) page, thereby resuming the existing CometD connection.
This extension requires only the client-side extension.
</para>
<section>
<info>
    <title>Enabling the Client-side Extension</title>
</info>
<para>
The <code>dojox/cometd/reload.js</code> provides the client side extension binding for Dojo, and it is sufficient to use Dojo's <code>dojo.require</code> mechanism:
</para>
<informalexample>
<programlisting language="javascript"><![CDATA[
dojo.require("dojox.cometd.reload");
]]>
</programlisting>
</informalexample>
<para>
The file <code>jquery.cometd-reload.js</code> provides the client-side extension binding for jQuery. This file must be included in the HTML page via the <code>&lt;script&gt;</code> tag, along with the <link xl:href="http://plugins.jquery.com/project/Cookie">jQuery cookie plugin</link> and the reload extension implementation:
</para>
<informalexample>
<programlisting language="javascript"><![CDATA[
&lt;script type="text/javascript" src="jquery.cookie.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="ReloadExtension.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="jquery.cometd-reload.js"&gt;&lt;/script&gt;
]]>
</programlisting>
</informalexample>
<para>
In both Dojo and jQuery extension bindings, the extension is registered on the default <code>cometd</code> object under the name "reload".
</para>
</section>
<section>
<info>
    <title>Understanding Reload Extension Details</title>
</info>
<para>
The reload extension allows CometD to reload a page with the reloaded page resuming an existing CometD connection.
</para>
<para>
To activate the reload extension, the page must call <code>cometd.reload()</code> just before the page is reloaded (for example, after clicking a link or on the page unload event).
This saves a short-lived cookie with the connection details.
The new page still needs to call subscribe to the channels it is interested in to register the callbacks, since the client state has been completely reset due to the reload.
</para>
<para>
A simple use example follows:
</para>
<informalexample>
<programlisting language="javascript"><![CDATA[
&lt;html&gt;
    &lt;head&gt;
        &lt;script type="text/javascript" src="dojo/dojo.js"&gt;&lt;/script&gt;
        &lt;script type="text/javascript"&gt;
            dojo.require("dojox.cometd");
            dojo.require("dojox.cometd.reload");

            dojox.cometd.init({ url: "/context/cometd", logLevel: "info" });
            dojox.cometd.subscribe("/some/channel", function() { ... });
            dojox.cometd.subscribe("/some/other/channel", function() { ... });
            
            // On page unload, call dojox.cometd.reload()
            dojo.addOnUnload(dojox.cometd, "reload");
        &lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
    ...
    &lt;/body&gt;
&lt;/html&gt;
]]>
</programlisting>
</informalexample>
</section>
</section>